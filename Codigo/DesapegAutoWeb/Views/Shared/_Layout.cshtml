@using Microsoft.AspNetCore.Identity
@using DesapegAutoWeb.Areas.Identity.Data
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager
@{
    var isSignedIn = SignInManager.IsSignedIn(User);
    var userName = UserManager.GetUserName(User) ?? "Usuário";
    var displayName = userName.Contains("@") ? userName.Split('@')[0] : userName;

    if (User.IsInRole("Admin"))
    {
        displayName = "Administrador";
    }

    var helpUrl = Url.Action("Privacy", "Home") ?? "#";
}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - DesapegAuto</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/DesapegAutoWeb.styles.css" asp-append-version="true" />
    <script>
        // Prevent FOUC (Flash of Unstyled Content)
        const savedTheme = localStorage.getItem('da-theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
    </script>
</head>
<body class="da-body">
    @if (isSignedIn)
    {
        <header class="da-topbar"
                data-controller="@ViewContext.RouteData.Values["controller"]"
                data-action="@ViewContext.RouteData.Values["action"]">
            <div class="da-topbar-inner">
                <div class="da-topbar-left">
                    <button class="da-back-btn" title="Voltar" aria-label="Voltar">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M19 12H5M12 5l-7 7 7 7"/></svg>
                    </button>
                    <a class="da-topbar-greeting" asp-controller="Home" asp-action="Index">Olá, @displayName</a>
                </div>
                <div class="da-topbar-center">
                    <a class="da-topbar-brand" asp-controller="Home" asp-action="Index">DesapegAuto</a>
                </div>
                <div class="da-topbar-actions">
                    <button class="da-theme-switch" title="Alternar Tema" aria-label="Alternar Tema">
                        <div class="da-theme-switch-track">
                            <div class="da-theme-switch-thumb">
                                <svg class="da-icon-sun" viewBox="0 0 24 24" aria-hidden="true">
                                    <path d="M12 2.25a.75.75 0 0 1 .75.75v2.25a.75.75 0 0 1-1.5 0V3a.75.75 0 0 1 .75-.75ZM7.5 12a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0ZM18.88 5.12a.75.75 0 0 0-1.06 0l-1.59 1.59a.75.75 0 1 0 1.06 1.06l1.59-1.59a.75.75 0 0 0 0-1.06ZM21.75 12a.75.75 0 0 1-.75.75h-2.25a.75.75 0 0 1 0-1.5H21a.75.75 0 0 1 .75.75ZM17.82 18.88a.75.75 0 0 0 0-1.06l-1.59-1.59a.75.75 0 1 0-1.06 1.06l1.59 1.59a.75.75 0 0 0 1.06 0ZM12 21.75a.75.75 0 0 1-.75-.75v-2.25a.75.75 0 0 1 1.5 0V21a.75.75 0 0 1-.75.75ZM5.12 18.88a.75.75 0 0 0 1.06 0l1.59-1.59a.75.75 0 0 0-1.06-1.06l-1.59 1.59a.75.75 0 0 0 0 1.06ZM2.25 12a.75.75 0 0 1 .75-.75h2.25a.75.75 0 0 1 0 1.5H3a.75.75 0 0 1-.75-.75ZM6.18 5.12a.75.75 0 0 0 0 1.06l1.59 1.59a.75.75 0 0 0 1.06-1.06L7.24 5.12a.75.75 0 0 0-1.06 0Z" />
                                </svg>
                                <svg class="da-icon-moon" viewBox="0 0 24 24" aria-hidden="true">
                                    <path d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.701-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" />
                                </svg>
                            </div>
                        </div>
                    </button>
                    <a class="da-icon-link" asp-controller="Perfil" asp-action="Index" title="Perfil" aria-label="Perfil">
                        <svg viewBox="0 0 24 24" aria-hidden="true">
                            <path d="M12 12a4.75 4.75 0 1 0 0-9.5 4.75 4.75 0 0 0 0 9.5Zm0 2.5c-4.33 0-8 2.28-8 5v1h16v-1c0-2.72-3.67-5-8-5Z" />
                        </svg>
                    </a>
                    <a class="da-icon-link" href="@helpUrl" title="Ajuda" aria-label="Ajuda">
                        <svg viewBox="0 0 24 24" aria-hidden="true">
                            <path d="M12 2.25A9.75 9.75 0 1 0 21.75 12 9.76 9.76 0 0 0 12 2.25Zm0 16.1a1.1 1.1 0 1 1 0 2.2 1.1 1.1 0 0 1 0-2.2Zm1.78-6.55-.72.45a1.3 1.3 0 0 0-.63 1.1v.4h-1.86v-.53a2.77 2.77 0 0 1 1.35-2.37l.88-.56a1.55 1.55 0 0 0 .75-1.34 1.57 1.57 0 1 0-3.14 0H8.55a3.43 3.43 0 1 1 6.86 0 3.33 3.33 0 0 1-1.63 2.85Z" />
                        </svg>
                    </a>
                </div>
            </div>
        </header>
    }
    else
    {
        <header class="da-topbar">
            <div class="da-topbar-inner">
                <div class="da-topbar-left"></div>
                <div class="da-topbar-center">
                    <a class="da-topbar-brand" asp-controller="Home" asp-action="Index">DesapegAuto</a>
                </div>
                <div class="da-topbar-actions">
                    <button class="da-theme-switch" title="Alternar Tema" aria-label="Alternar Tema">
                        <div class="da-theme-switch-track">
                            <div class="da-theme-switch-thumb">
                                <svg class="da-icon-sun" viewBox="0 0 24 24" aria-hidden="true">
                                    <path d="M12 2.25a.75.75 0 0 1 .75.75v2.25a.75.75 0 0 1-1.5 0V3a.75.75 0 0 1 .75-.75ZM7.5 12a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0ZM18.88 5.12a.75.75 0 0 0-1.06 0l-1.59 1.59a.75.75 0 1 0 1.06 1.06l1.59-1.59a.75.75 0 0 0 0-1.06ZM21.75 12a.75.75 0 0 1-.75.75h-2.25a.75.75 0 0 1 0-1.5H21a.75.75 0 0 1 .75.75ZM17.82 18.88a.75.75 0 0 0 0-1.06l-1.59-1.59a.75.75 0 1 0-1.06 1.06l1.59 1.59a.75.75 0 0 0 1.06 0ZM12 21.75a.75.75 0 0 1-.75-.75v-2.25a.75.75 0 0 1 1.5 0V21a.75.75 0 0 1-.75.75ZM5.12 18.88a.75.75 0 0 0 1.06 0l1.59-1.59a.75.75 0 0 0-1.06-1.06l-1.59 1.59a.75.75 0 0 0 0 1.06ZM2.25 12a.75.75 0 0 1 .75-.75h2.25a.75.75 0 0 1 0 1.5H3a.75.75 0 0 1-.75-.75ZM6.18 5.12a.75.75 0 0 0 0 1.06l1.59 1.59a.75.75 0 0 0 1.06-1.06L7.24 5.12a.75.75 0 0 0-1.06 0Z" />
                                </svg>
                                <svg class="da-icon-moon" viewBox="0 0 24 24" aria-hidden="true">
                                    <path d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.701-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" />
                                </svg>
                            </div>
                        </div>
                    </button>
                    <a class="da-topbar-link" asp-area="Identity" asp-page="/Account/Login">Entrar</a>
                    <a class="da-topbar-link" asp-area="Identity" asp-page="/Account/Register">Criar conta</a>
                </div>
            </div>
        </header>
    }

    <main class="da-main">
        @RenderBody()
    </main>

    <footer class="da-footer">
        <div class="da-footer-inner">
            <div class="da-footer-brand-col">
                <a class="da-footer-logo" asp-controller="Home" asp-action="Index">DesapegAuto</a>
                <p class="da-footer-desc">O marketplace de veículos que conecta compradores e concessionárias com transparência e confiança.</p>
                <div class="da-footer-social">
                    <a class="da-footer-social-link da-social-instagram" href="#" aria-label="Instagram" title="Instagram">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <rect x="2" y="2" width="20" height="20" rx="5" ry="5"/>
                            <circle cx="12" cy="12" r="4"/>
                            <circle cx="17.5" cy="6.5" r="0.5" fill="currentColor" stroke="none"/>
                        </svg>
                    </a>
                    <a class="da-footer-social-link da-social-facebook" href="#" aria-label="Facebook" title="Facebook">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/>
                        </svg>
                    </a>
                    <a class="da-footer-social-link da-social-whatsapp" href="#" aria-label="WhatsApp" title="WhatsApp">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
                        </svg>
                    </a>
                </div>
            </div>

            <nav class="da-footer-nav-col" aria-label="Navegação do rodapé">
                <h4 class="da-footer-heading">Navegação</h4>
                <ul class="da-footer-nav-list">
                    <li><a asp-controller="Home" asp-action="Index">Início</a></li>
                    <li><a asp-controller="Home" asp-action="Search">Buscar veículos</a></li>
                    @if (isSignedIn)
                    {
                        <li><a asp-controller="Perfil" asp-action="Index">Meu perfil</a></li>
                    }
                    else
                    {
                        <li><a asp-area="Identity" asp-page="/Account/Login">Entrar</a></li>
                        <li><a asp-area="Identity" asp-page="/Account/Register">Criar conta</a></li>
                    }
                </ul>
            </nav>

            <div class="da-footer-legal-col">
                <h4 class="da-footer-heading">Legal</h4>
                <ul class="da-footer-nav-list">
                    <li><a asp-controller="Home" asp-action="Privacy">Política de Privacidade</a></li>
                    <li><a asp-controller="Home" asp-action="Privacy">Termos de Uso</a></li>
                </ul>
            </div>
        </div>
        <div class="da-footer-bottom">
            <p>&copy; 2026 DesapegAuto. Todos os direitos reservados.</p>
        </div>
    </footer>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>

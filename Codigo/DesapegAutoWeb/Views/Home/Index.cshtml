@model IEnumerable<DesapegAutoWeb.Models.AnuncioViewModel>
@using System.Globalization
@{
    ViewData["Title"] = "Início";
    var anuncios = Model?.ToList() ?? new List<DesapegAutoWeb.Models.AnuncioViewModel>();
    var isAdmin = User.IsInRole("Admin");
    var isSignedIn = User.Identity?.IsAuthenticated ?? false;
    var canAnnounce = User.IsInRole("Admin") || User.IsInRole("Funcionario");
}

<div class="da-page">
    @if (isAdmin)
    {
        <h1 class="da-title">Painel Administrativo</h1>

        <section class="da-admin-panel-grid">
            <article class="da-admin-card">
                <div>
                    <h3>Marcas</h3>
                    <p>Gerencie as marcas de veículos disponíveis no sistema.</p>
                </div>
                <a class="da-btn da-btn-primary da-btn-wide" asp-controller="Marca" asp-action="Index">Gerenciar Marcas</a>
            </article>

            <article class="da-admin-card">
                <div>
                    <h3>Categorias</h3>
                    <p>Gerencie as categorias de veículos do sistema.</p>
                </div>
                <a class="da-btn da-btn-primary da-btn-wide" asp-controller="Categoria" asp-action="Index">Gerenciar Categorias</a>
            </article>

            <article class="da-admin-card">
                <div>
                    <h3>Modelos</h3>
                    <p>Gerencie os modelos e versões de veículos disponíveis.</p>
                </div>
                <a class="da-btn da-btn-primary da-btn-wide" asp-controller="Modelo" asp-action="Index">Gerenciar Modelos</a>
            </article>

            <article class="da-admin-card">
                <div>
                    <h3>Concessionárias</h3>
                    <p>Gerencie as concessionárias cadastradas no sistema.</p>
                </div>
                <a class="da-btn da-btn-primary da-btn-wide" asp-controller="Concessionaria" asp-action="Index">Gerenciar Concessionárias</a>
            </article>

            <article class="da-admin-card">
                <div>
                    <h3>Anúncios</h3>
                    <p>Crie e acompanhe os anúncios de veículos.</p>
                </div>
                <a class="da-btn da-btn-primary da-btn-wide" asp-controller="Anuncio" asp-action="Create">Anunciar veículo</a>
            </article>
        </section>
    }
    else
    {
        <section class="da-card da-card-pad da-home-actions">
            <div class="da-home-actions-main">
                <div>
                    <h2 class="da-subtitle">Quer anunciar seu veículo?</h2>
                    <p class="da-muted">Para anunciar, é preciso vincular uma concessionária ao cadastro.</p>
                </div>
                <div class="da-home-actions-cta">
                    @if (canAnnounce)
                    {
                        <a class="da-btn da-btn-primary da-btn-wide" asp-controller="Anuncio" asp-action="Create">Anunciar veículo</a>
                    }
                    else if (!isSignedIn)
                    {
                        <a class="da-btn da-btn-primary da-btn-wide" asp-area="Identity" asp-page="/Account/Login" asp-route-returnUrl="@Url.Action("Create", "Anuncio")">Entrar para anunciar</a>
                    }
                    else
                    {
                        <button type="button" class="da-btn da-btn-soft da-btn-wide" disabled>Disponível para Admin/Funcionário</button>
                    }
                </div>
            </div>
        </section>

        <section class="da-card da-card-pad da-home-search">
            <form asp-controller="Home" asp-action="Search" method="get">
                <div class="da-field">
                    <input type="text" name="termo" class="da-input" placeholder="Selecione marca ou modelo do veículo" />
                </div>
                <button type="submit" class="da-btn da-btn-primary da-btn-wide">Ver anúncios</button>
            </form>
        </section>

        <h2 class="da-subtitle">Alguns anúncios</h2>

        <section class="da-home-results">
            @if (anuncios.Any())
            {
                foreach (var anuncio in anuncios)
                {
                    var nomeVeiculo = $"{anuncio.Veiculo?.NomeMarca} {anuncio.Veiculo?.NomeModelo}".Trim();
                    if (string.IsNullOrWhiteSpace(nomeVeiculo))
                    {
                        nomeVeiculo = "Veículo";
                    }

                    <article class="da-vehicle-card">
                        <div class="da-vehicle-image">
                            <div class="da-vehicle-placeholder">Imagem do veículo</div>
                        </div>
                        <div class="da-vehicle-body">
                            <h3 class="da-vehicle-name">@nomeVeiculo</h3>
                            <p class="da-vehicle-year">@anuncio.Veiculo?.Ano</p>
                            <p class="da-vehicle-price">@((anuncio.Veiculo?.Preco ?? 0m).ToString("C0", new CultureInfo("pt-BR")))</p>
                            <a asp-controller="Anuncio" asp-action="Details" asp-route-id="@anuncio.Id" class="da-btn da-btn-outline da-btn-wide">Ver detalhes</a>
                        </div>
                    </article>
                }
            }
            else
            {
                <div class="da-empty">Nenhum anúncio disponível no momento.</div>
            }
        </section>
    }
</div>

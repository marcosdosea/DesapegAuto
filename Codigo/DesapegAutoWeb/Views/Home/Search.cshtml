@model IEnumerable<DesapegAutoWeb.Models.AnuncioViewModel>
@{
    ViewData["Title"] = "Busca de Veículos";
}

<!-- Hero Section for Search -->
<div class="hero mb-5" style="padding: 60px 0 40px;">
    <div class="container">
        <div class="hero-content text-center">
            <h1 class="display-1" style="font-size: 3rem; margin-bottom: 16px;">Encontre seu próximo carro</h1>
            <p class="text-secondary" style="font-size: 1.1rem;">Explore nossa seleção variada de veículos verificados.</p>
        </div>
    </div>
</div>

<div class="container mb-5">
    <div class="search-grid">
        <!-- Sidebar de Filtros -->
        <div>
            <div class="glass-card" style="padding: 24px;">
                <div class="mb-4">
                    <h3 class="h5" style="margin:0;">Filtros</h3>
                </div>

                <form asp-controller="Home" asp-action="Search" method="get">

                    <!-- Termo -->
                    <div class="mb-4">
                        <label class="form-label">Busca</label>
                        <div class="search-bar-container w-100">
                            <i class="fas fa-search text-muted" style="padding-left: 12px; align-self: center;"></i>
                            <input type="text" name="termo" class="search-input" placeholder="Ex: BMW X5"
                                value="@ViewBag.Termo" />
                        </div>
                    </div>

                    <!-- Localização -->
                    <div class="mb-4">
                        <label class="form-label">Localização</label>
                        <input type="text" name="localizacao" class="form-control" placeholder="Cidade ou Estado"
                            value="@ViewBag.Localizacao" />
                    </div>

                    <!-- Preço -->
                    <div class="mb-4">
                        <label class="form-label">Preço</label>
                        <div class="d-flex gap-2">
                            <input type="number" name="precoMin" class="form-control" placeholder="Mín"
                                value="@ViewBag.PrecoMin" />
                            <input type="number" name="precoMax" class="form-control" placeholder="Máx"
                                value="@ViewBag.PrecoMax" />
                        </div>
                    </div>

                    <!-- Ano -->
                    <div class="mb-4">
                        <label class="form-label">Ano</label>
                        <div class="d-flex gap-2">
                            <input type="number" name="anoMin" class="form-control" placeholder="De"
                                value="@ViewBag.AnoMin" />
                            <input type="number" name="anoMax" class="form-control" placeholder="Até"
                                value="@ViewBag.AnoMax" />
                        </div>
                    </div>

                    <!-- Opcionais -->
                    <div class="mb-4">
                        <label class="form-label">Opcionais</label>
                        <div class="d-flex flex-column gap-2">
                            @foreach (var opcional in new[] { "Teto Solar", "Couro", "Automático", "4x4", "Híbrido", "Sport" })
                            {
                                <div class="d-flex align-center gap-2">
                                    <input type="checkbox" name="opcionais" value="@opcional.ToLower()" 
                                           id="opt_@opcional.Replace(" ", "")" 
                                           style="width: 16px; height: 16px; accent-color: var(--text-primary);">
                                    <label for="opt_@opcional.Replace(" ", "")" style="font-size: 0.9rem; color: var(--text-secondary); cursor: pointer;">
                                        @opcional
                                    </label>
                                </div>
                            }
                        </div>
                    </div>

                    <div class="d-flex gap-2 mt-4">
                        <a href="@Url.Action("Search", "Home")" class="btn btn-outline w-100">Limpar</a>
                        <button type="submit" class="btn btn-primary w-100">Filtrar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Lista de Resultados -->
        <div>
            <div class="d-flex justify-between align-center mb-4">
                <h2 class="h3">Veículos Disponíveis</h2>
                <span class="text-secondary">@(Model?.Count() ?? 0) resultados</span>
            </div>

            @if (Model != null && Model.Any())
            {
                <div class="d-flex flex-column gap-3">
                    @foreach (var anuncio in Model)
                    {
                        <div class="vehicle-card-horizontal">
                            <div class="vehicle-image-large">
                                @if (!string.IsNullOrEmpty(anuncio.Veiculo?.ImagemPrincipal))
                                {
                                    <img src="@anuncio.Veiculo.ImagemPrincipal" alt="@anuncio.Veiculo.NomeModelo" />
                                }
                                else
                                {
                                    <i class="fas fa-car fa-3x text-muted"></i>
                                }
                            </div>
                            <div class="vehicle-result-info">
                                <div class="d-flex justify-between align-center mb-2">
                                    <div>
                                        <div class="d-flex align-center gap-2 mb-1">
                                            <span class="badge" style="background: rgba(255, 255, 255, 0.1); color: var(--text-primary);">Destaque</span>
                                            <h3 class="h4" style="margin: 0;">@(anuncio.Veiculo?.NomeMarca ?? "Marca") @(anuncio.Veiculo?.NomeModelo ?? "Modelo")</h3>
                                        </div>
                                        <p class="text-secondary" style="font-size: 0.9rem;">
                                            @anuncio.Veiculo?.Ano • @(anuncio.Veiculo?.Quilometragem.ToString("N0") ?? "0") km
                                        </p>
                                    </div>
                                    <div style="font-size: 1.5rem; font-weight: 600;">@anuncio.Veiculo?.Preco.ToString("C")</div>
                                </div>

                                <p class="text-secondary" style="font-size: 0.9rem; line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; margin-bottom: auto;">
                                    @(anuncio.Descricao ?? "Veículo em excelente estado, revisado e com garantia. Entre em contato para mais detalhes.")
                                </p>

                                <div class="d-flex gap-2 mt-3">
                                    <a asp-controller="Anuncio" asp-action="Details" asp-route-id="@anuncio.Id"
                                        class="btn btn-primary">Ver Detalhes</a>
                                    <button class="btn btn-outline btn-icon" title="Salvar Favorito">
                                        <i class="far fa-heart"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            }
            else
            {
                <div class="glass-card d-flex flex-column align-center" style="padding: 80px 0; text-align: center;">
                    <div style="width: 80px; height: 80px; background: rgba(255,255,255,0.05); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 24px;">
                        <i class="fas fa-search fa-2x text-muted"></i>
                    </div>
                    <h3 class="h5 mb-2">Nenhum veículo encontrado</h3>
                    <p class="text-secondary" style="max-width: 300px; margin: 0 auto;">Tente ajustar seus filtros ou busque por outros termos.</p>
                    <a href="@Url.Action("Search", "Home")" class="btn btn-outline mt-4">Limpar Filtros</a>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
        <script>
            $(document).ready(function () {
        @if (ViewBag.Opcionais != null)
        {
            @foreach (var opcional in ViewBag.Opcionais)
            {
                <text>
                                $('input[name="opcionais"][value="@opcional"]').prop('checked', true);
                </text>
            }
        }
            });
        </script>
}
